<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forgot Password - TrainUp</title>

    <!-- CSS Files -->
    <link rel="stylesheet" href="../../css/fonts.css">
    <link rel="stylesheet" href="../../css/style.css">
    <link rel="stylesheet" href="../../css/auth.css">

    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="auth-container">
        <!-- Left Side - Branding -->
        <div class="auth-branding">
            <div class="branding-content">
                <h1 class="logo">
                    <i class="fas fa-graduation-cap"></i>
                    TrainUp
                </h1>
                <p class="tagline">Password Recovery</p>

                <div class="features">
                    <div class="feature">
                        <i class="fas fa-shield-alt"></i>
                        <span>Secure Password Reset</span>
                    </div>
                    <div class="feature">
                        <i class="fas fa-envelope"></i>
                        <span>Email Verification</span>
                    </div>
                    <div class="feature">
                        <i class="fas fa-lock"></i>
                        <span>Account Protection</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Side - Form -->
        <div class="auth-form-container">
            <div class="auth-form-wrapper">
                <div style="margin-bottom: 1rem;">
                    <a href="login.html" style="display: inline-flex; align-items: center; gap: 0.5rem; color: var(--primary-color); font-weight: 500;">
                        <i class="fas fa-arrow-left"></i>
                        Back to Login
                    </a>
                </div>

                <h2>Forgot Password?</h2>
                <p class="subtitle">No worries! Enter your email and we'll send you reset instructions.</p>

                <!-- Alert Messages -->
                <div id="alertMessage" class="alert" style="display: none;"></div>

                <!-- Form -->
                <form id="forgotPasswordForm" class="auth-form">
                    <!-- Email Field -->
                    <div class="form-group">
                        <label for="email">
                            <i class="fas fa-envelope"></i>
                            Email Address
                        </label>
                        <input
                            type="email"
                            id="email"
                            name="email"
                            placeholder="Enter your registered email"
                            required
                        >
                        <span class="error-message" id="emailError"></span>
                    </div>

                    <!-- Submit Button -->
                    <button type="submit" class="btn btn-primary" id="resetBtn">
                        <span id="resetBtnText">
                            <i class="fas fa-paper-plane"></i>
                            Send Reset Link
                        </span>
                        <span id="resetBtnLoader" class="loader" style="display: none;"></span>
                    </button>
                </form>

                <!-- Success State (hidden initially) -->
                <div id="successState" style="display: none; text-align: center; padding: 2rem 0;">
                    <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #10B981 0%, #059669 100%); border-radius: 50%; margin: 0 auto 1.5rem; display: flex; align-items: center; justify-content: center; box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3);">
                        <i class="fas fa-check" style="font-size: 2.5rem; color: white;"></i>
                    </div>
                    <h3 style="margin-bottom: 0.75rem; color: var(--text-primary);">Check Your Email!</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 1.5rem; line-height: 1.7;">
                        We've sent password reset instructions to<br>
                        <strong id="sentEmail" style="color: var(--primary-color);"></strong>
                    </p>
                    <p style="color: var(--text-light); font-size: 0.875rem; margin-bottom: 1.5rem;">
                        Didn't receive the email? Check your spam folder or
                    </p>
                    <button onclick="window.location.reload()" class="btn btn-outline" style="display: inline-flex;">
                        <i class="fas fa-redo"></i>
                        Try Again
                    </button>
                </div>

                <!-- Footer -->
                <div class="auth-footer">
                    <p>Remember your password? <a href="login.html">Login here</a></p>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Files -->
    <script src="../../js/core/config.js"></script>
    <script src="../../js/core/auth.js"></script>
    <script>
        // Forgot Password Form Handler
        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('forgotPasswordForm');
            const successState = document.getElementById('successState');

            form.addEventListener('submit', async (e) => {
                e.preventDefault();

                // Clear previous errors
                document.querySelectorAll('.error-message').forEach(el => el.textContent = '');
                const alertMessage = document.getElementById('alertMessage');
                alertMessage.style.display = 'none';

                // Get email
                const email = document.getElementById('email').value.trim();

                // Validate
                if (!email) {
                    document.getElementById('emailError').textContent = 'Email is required';
                    return;
                }

                if (!validateEmail(email)) {
                    document.getElementById('emailError').textContent = 'Please enter a valid email address';
                    return;
                }

                // Show loading
                const resetBtn = document.getElementById('resetBtn');
                const resetBtnText = document.getElementById('resetBtnText');
                const resetBtnLoader = document.getElementById('resetBtnLoader');

                resetBtn.disabled = true;
                resetBtnText.style.display = 'none';
                resetBtnLoader.style.display = 'inline-block';

                try {
                    // Make API request
                    const response = await apiRequest(API_ENDPOINTS.AUTH.FORGOT_PASSWORD, {
                        method: 'POST',
                        body: JSON.stringify({ email })
                    });

                    if (response.success) {
                        // Show success state
                        form.style.display = 'none';
                        document.querySelector('.auth-footer').style.display = 'none';
                        document.getElementById('sentEmail').textContent = email;
                        successState.style.display = 'block';
                    } else {
                        alertMessage.className = 'alert alert-error';
                        alertMessage.textContent = response.message || 'Failed to send reset link. Please try again.';
                        alertMessage.style.display = 'block';
                    }

                } catch (error) {
                    console.error('Forgot password error:', error);
                    alertMessage.className = 'alert alert-error';
                    alertMessage.textContent = error.message || 'An error occurred. Please try again.';
                    alertMessage.style.display = 'block';

                } finally {
                    resetBtn.disabled = false;
                    resetBtnText.style.display = 'inline';
                    resetBtnLoader.style.display = 'none';
                }
            });

            // Clear error on input
            document.getElementById('email').addEventListener('input', () => {
                document.getElementById('emailError').textContent = '';
            });
        });
    </script>
</body>
</html>

